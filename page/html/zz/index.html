<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>政治倾向测试 | SHUOWEB</title>
  <!-- 仅引用shuoweb官方通用JS -->
  <script src="https://shuoweb.com/common.js"></script>
  <!-- 引用指定地址的题目数据JS -->
  <script src="https://shuoweb.com/page/html/zz/data.js"></script>
  <style>
    /* 单选框高亮样式：加粗描边+主题色+外发光，超明显 */
    .custom-radio {
      width: 20px !important;
      height: 20px !important;
      min-width: 20px !important;
      border: 2px solid var(--text-sub) !important;
      border-radius: 50% !important;
      cursor: pointer !important;
      transition: all 0.3s ease !important;
      background: var(--card-bg) !important;
      appearance: none !important;
      -webkit-appearance: none !important;
      position: relative !important;
    }
    /* 选中后的高亮样式：主题色描边+外发光+内部圆点 */
    .custom-radio.checked {
      border-color: var(--primary) !important;
      box-shadow: 0 0 0 3px var(--primary-light) !important;
    }
    .custom-radio.checked::after {
      content: '' !important;
      position: absolute !important;
      top: 3px !important;
      left: 3px !important;
      width: 10px !important;
      height: 10px !important;
      border-radius: 50% !important;
      background: var(--primary) !important;
    }
    /* 选项悬浮效果：文字变主题色，提示可点击 */
    .quiz-option {
      cursor: pointer;
      transition: color 0.3s ease;
      display: flex !important;
      align-items: center !important;
      gap: 12px !important;
      padding: 6px 0 !important;
    }
    .quiz-option:hover .opt-text {
      color: var(--primary) !important;
    }
    .opt-text {
      color: var(--text-sub) !important;
      text-align: left !important;
      font-size: 15px !important;
      margin: 0 !important;
    }
    .question-title {
      font-size: 16px !important;
      color: var(--text-main) !important;
      margin: 0 0 12px !important;
      text-align: left !important;
      line-height: 1.6 !important;
    }
  </style>
</head>
<body>
  <div id="content" style="max-width:800px;padding:20px 15px 80px;margin:0 auto;">
    <div class="section" style="background:var(--card-bg);padding:30px 20px;border-radius:var(--radius);box-shadow:var(--shadow);">
      <h1 style="margin:0 0 30px;font-size:28px;">政治倾向测试</h1>
      <div id="quiz" style="display:flex;flex-direction:column;gap:25px;margin-bottom:30px;"></div>
      <button id="submit" style="width:100%;max-width:400px;margin:0 auto;padding:12px 0;font-size:16px;">
        完成测试 · 查看结果
      </button>
      <div id="result" style="margin-top:30px;padding-top:30px;border-top:1px solid rgba(255,255,255,0.3);"></div>
    </div>
  </div>

  <script>
    // 全局存储选中状态：{ 题目ID: 选中的选项索引, ... }
    let selectStatus = {};

    // 渲染题目：使用自定义单选框，完全抛弃原生行为
    function renderQuiz() {
      const quizEl = document.getElementById('quiz');
      quizEl.innerHTML = '';
      
      // 调用指定数据JS中的PoliticalTest对象
      PoliticalTest.questions.forEach((q, idx) => {
        const qDiv = document.createElement('div');
        qDiv.style.padding = '10px 0';
        // 题目标题
        const qTitle = document.createElement('p');
        qTitle.className = 'question-title';
        qTitle.innerText = `${idx+1}. ${q.text}`;
        qDiv.appendChild(qTitle);
        
        // 选项容器
        const optDiv = document.createElement('div');
        optDiv.style.display = 'flex';
        optDiv.style.flexDirection = 'column';
        optDiv.style.gap = '8px';
        optDiv.style.paddingLeft = '5px';

        // 渲染每个选项
        q.options.forEach((opt, oIdx) => {
          const optionLabel = document.createElement('div');
          optionLabel.className = 'quiz-option';
          
          // 自定义单选框（非原生input，彻底避免原生行为干扰）
          const radio = document.createElement('div');
          radio.className = 'custom-radio';
          // 初始化时如果有选中状态，添加checked类
          if (selectStatus[q.id] === oIdx) radio.classList.add('checked');
          
          // 选项文字
          const textSpan = document.createElement('p');
          textSpan.className = 'opt-text';
          textSpan.innerText = opt.text;
          
          // 核心点击逻辑：点击切换选中状态，永久保存
          optionLabel.addEventListener('click', (e) => {
            e.stopPropagation(); // 阻止事件冒泡
            // 切换选中状态：已选中则取消，未选中则选中
            if (selectStatus[q.id] === oIdx) {
              delete selectStatus[q.id]; // 取消选中
              radio.classList.remove('checked');
            } else {
              selectStatus[q.id] = oIdx; // 保存选中状态
              // 移除当前题目其他选项的选中样式
              Array.from(optDiv.querySelectorAll('.custom-radio')).forEach(r => r.classList.remove('checked'));
              // 给当前选项添加选中样式
              radio.classList.add('checked');
            }
          });

          // 组装选项
          optionLabel.appendChild(radio);
          optionLabel.appendChild(textSpan);
          optDiv.appendChild(optionLabel);
        });

        qDiv.appendChild(optDiv);
        quizEl.appendChild(qDiv);
      });
    }

    // 计算分数+匹配人物：读取自定义选中状态
    function showResult() {
      let score = { economic:0, social:0, authority:0, global:0 };
      let allAnswered = true;

      // 遍历所有题目，检查是否都已选中
      PoliticalTest.questions.forEach(q => {
        // 判断当前题目是否有选中状态
        if (selectStatus[q.id] === undefined) {
          allAnswered = false;
          return;
        }
        // 根据选中的索引获取分数
        const s = q.options[selectStatus[q.id]].score;
        score.economic += s.economic || 0;
        score.social += s.social || 0;
        score.authority += s.authority || 0;
        score.global += s.global || 0;
      });

      if (!allAnswered) {
        alert('请完成所有题目后再提交～');
        return;
      }

      // 调用指定数据JS中的匹配逻辑
      const matchFigure = PoliticalTest.getResult(score);
      // 渲染结果
      document.getElementById('result').innerHTML = `
        <h3 style="font-size:20px;margin:0 0 20px;">你的政治倾向得分</h3>
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:15px;margin-bottom:30px;">
          <p style="padding:10px;background:var(--primary-light);border-radius:8px;margin:0;">经济轴：<b style="color:var(--primary);">${score.economic}</b></p>
          <p style="padding:10px;background:var(--primary-light);border-radius:8px;margin:0;">社会轴：<b style="color:var(--primary);">${score.social}</b></p>
          <p style="padding:10px;background:var(--primary-light);border-radius:8px;margin:0;">权威自由轴：<b style="color:var(--primary);">${score.authority}</b></p>
          <p style="padding:10px;background:var(--primary-light);border-radius:8px;margin:0;">国际观轴：<b style="color:var(--primary);">${score.global}</b></p>
        </div>
        <h3 style="font-size:20px;margin:0 0 15px;">你最像：<span style="color:var(--primary);">${matchFigure.name}</span></h3>
        <p style="font-size:16px;padding:15px;background:var(--primary-light);border-radius:8px;margin:0;text-align:center !important;">${matchFigure.desc}</p>
      `;
    }

    // 页面初始化+点击其他区域不影响选中状态
    document.addEventListener('DOMContentLoaded', () => {
      renderQuiz();
      document.getElementById('submit').addEventListener('click', showResult);
      // 点击页面任意区域，都不改变选中状态（彻底解决消失问题）
      document.addEventListener('click', (e) => {
        // 仅拦截非选项区域的点击，不做任何状态修改
        if (!e.target.closest('.quiz-option')) return;
      });
      // 主题切换后重新渲染，保证样式同步
      const themeBtn = document.getElementById('themeText');
      themeBtn && themeBtn.addEventListener('click', () => {
        setTimeout(renderQuiz, 100); // 延迟渲染，等待主题色切换完成
      });
    });
  </script>
</body>
</html>
